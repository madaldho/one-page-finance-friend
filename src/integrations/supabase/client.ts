// This file is automatically generated. Do not edit it directly.
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

// Use environment variables when available, otherwise use the fallback values
const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL || "https://pjwmfyvknbtoofxfuwjm.supabase.co";
const SUPABASE_PUBLISHABLE_KEY = import.meta.env.VITE_SUPABASE_ANON_KEY || "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBqd21meXZrbmJ0b29meGZ1d2ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ3OTQ2NTgsImV4cCI6MjA2MDM3MDY1OH0.yrje_gdq9gODnMZbxUO6giRz4ID4SOpcmBlBOIDOK1U";

// Import the supabase client like this:
// import { supabase } from "@/integrations/supabase/client";

// Validate configuration
if (!SUPABASE_URL || !SUPABASE_PUBLISHABLE_KEY) {
  console.error('❌ Supabase configuration missing. Please check your environment variables.');
}

// Konfigurasi untuk memperpanjang durasi sesi menjadi 30 hari dan memastikan persistensi sesi
export const supabase = createClient<Database>(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY, {
  auth: {
    persistSession: true, // Pertahankan sesi di local storage
    storageKey: 'supabase_auth_token', // Kunci untuk menyimpan token di storage
    autoRefreshToken: true, // Otomatis refresh token saat expired
    detectSessionInUrl: true, // Deteksi sesi dari URL (penting untuk login OAuth)
    flowType: 'pkce', // Gunakan PKCE flow untuk keamanan lebih baik (Proof Key for Code Exchange)
  },
  global: {
    // Menambahkan headers untuk request Supabase
    headers: {
      'x-application-name': 'Wordy Greeting Echo',
    },
  },
  // Konfigurasi cache untuk performa lebih baik
  realtime: {
    params: {
      eventsPerSecond: 10,
    },
  },
});

// Test connection on startup (in development)
if (import.meta.env.DEV) {
  supabase.auth.getSession()
    .then(({ error }) => {
      if (error) {
        console.warn('⚠️ Supabase connection test failed:', error.message);
      } else {
        console.log('✅ Supabase connection successful');
      }
    })
    .catch((error) => {
      console.warn('⚠️ Supabase connection test error:', error.message);
    });
}
